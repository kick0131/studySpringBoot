version: 2.1
jobs:
  # Step1
  static-test:
    docker:
      - image: alpine:3.15
    steps:
      - run: echo "static test"

  # Step2
  build:
    docker:
      # new image is
      # https://github.com/CircleCI-Public/cimg-go
      #- image: circleci/golang:1.17
      - image: cimg/go:1.17
    steps:
      - run: echo "hello world"
      - run: go version

  # Step3
  dynamic-test:
    docker:
      - image: alpine:3.15
    steps:
      - run: echo "dynamic test"

  # Step4
  deploy:
    docker:
      - image: alpine:3.15
    steps:
      - run: echo "deploy"

workflows:
  version: 2
  test-and-deploy:
    jobs:
      - static-test
      - build:
        requires:
          - static-test
      - dynamic-test:
        requires:
          - build
      - deploy:
        requires:
          - dynamic-test
